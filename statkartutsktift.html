<!DOCTYPE HTML>
<html>
    <head>
        <script src="jquery-2.1.1.js"></script>
        <script src="statkart.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
		<div id="paper" style="position:absolute;top:0;left:0;overflow: hidden;width:210mm;height:297mm;">
        <div id="container" style="position:absolute;top:0;left:0;width:10000mm;height:10000mm">
        </div>
				<div id="Copyright">Â© Kartverket</div>
			<div id="UTM"></div>
			</div>


            
	<script>
		var QueryString = function () {
  // This function is anonymous, is executed immediately and 
  // the return value is assigned to QueryString!
  var query_string = {};
  var query = window.location.search.substring(1);
  var vars = query.split("&");
  for (var i=0;i<vars.length;i++) {
    var pair = vars[i].split("=");
    	// If first entry with this name
    if (typeof query_string[pair[0]] === "undefined") {
      query_string[pair[0]] = pair[1];
    	// If second entry with this name
    } else if (typeof query_string[pair[0]] === "string") {
      var arr = [ query_string[pair[0]], pair[1] ];
      query_string[pair[0]] = arr;
    	// If third or later entry with this name
    } else {
      query_string[pair[0]].push(pair[1]);
    }
  } 
    return query_string;
} ();
		$().ready(function(){
			var UTM = 33
			var zoom = 13
			var papertype = "A3Landscape"
			var resolution = 50000.;
			var xLUtmPrint = 227000;
			var yHUtmPrint = 7044000;
			
			var xLUtmWms = 0;
			var yLUtmWms = 0;
			var xHUtmWms = 0;
			var yHUtmWms = 0;
			
			if (UTM == 32){
				xLUtmWms = -2000000; 
				yLUtmWms = 3500000;
				xHUtmWms = 3545984;s
				yHUtmWms = 9045984;
				} else if( UTM == 33){
				xLUtmWms = -2500000; 
				yLUtmWms = 	3500000;
				xHUtmWms = 	3045984;
				yHUtmWms = 	9045984;
				} else if( UTM == 34) {
				xLUtmWms = -3000000; 
				yLUtmWms = 	3500000;
				xHUtmWms = 	2545984;
				yHUtmWms = 	9045984;
				} else if( UTM == 35){
				xLUtmWms = -3500000; 
				yLUtmWms = 	3500000;
				xHUtmWms = 	2045984;
				yHUtmWms = 	9045984;
				} else if( UTM == 36){
				xLUtmWms = -4000000; 
				yLUtmWms = 	3500000;
				xHUtmWms = 	1545984;
				yHUtmWms = 	9045984;
				} else {
					window.alert("Input UTM zone is not supported");
				}

			var dxUTM = (xHUtmWms-xLUtmWms)/Math.pow(2,zoom);
			var dyUTM = (yHUtmWms-yLUtmWms)/Math.pow(2,zoom);
			var xLUTM = xLUtmPrint-(xLUtmPrint-xLUtmWms) % dxUTM;
			var yHUTM = yHUtmPrint+dyUTM-(yHUtmPrint-yLUtmWms) % dyUTM;
			
			var paperWidth = .210;
			var paperHeight = .297;
			if (papertype == "A4"){
				paperWidth = .210;
				paperHeight = .297;
			} else if (papertype == "A3") {
				paperWidth = .297;
				paperHeight = .420;
			} else if (papertype == "A3Landscape") {
				paperWidth = .420;
				paperHeight = .297;
			}
			$("#paper")[0].style.width=(paperWidth*1000)+"mm";
			$("#paper")[0].style.height=(paperHeight*1000)+"mm";
						
			
			var yOffsetMM = (yHUtmPrint-yHUTM)/resolution*1000;
			var xOffsetMM = -(xLUtmPrint-xLUTM)/resolution*1000;
			$("#UTM")[0].innerText="UTM Zone: "+UTM;
			$("#container")[0].style.top = yOffsetMM +"mm";
			$("#container")[0].style.left = xOffsetMM +"mm";
			var imgWitdhMM =(dxUTM*1000./resolution);
			var imgHeighthMM =(dyUTM*1000./resolution);
			for (var i = 0; i < paperWidth/imgWitdhMM*1000+1; i++) {
				for (var j = 0; j < paperHeight/imgHeighthMM*1000+1; j++) {
					var img = document.createElement("img");
					var div = document.createElement("div");
					div.appendChild(img)
					var xL = xLUTM+dxUTM*i;
					var yL = yHUTM-dyUTM*j;
					img.src = "http://opencache.statkart.no/gatekeeper/gk/gk.open?request=GetMap&LAYERS=toporaster2&VERSION=1.0.0&BBOX="+xL+","+(yL-dyUTM)+","+(xL+dxUTM)+","+(yL)+"&SRS=EPSG:326"+UTM+"&WIDTH=256&HEIGHT=256&FORMAT=image/png";
					img.style.width = imgWitdhMM+"mm";
					img.style.height = imgHeighthMM+"mm";
					img.style.position ="absolute";
					img.style.top=0;
					img.style.left=0;
					div.style.position ="absolute";
					div.style.top=(0+imgHeighthMM*j)+"mm";
					div.style.left=(0+imgWitdhMM*i)+"mm";
					$("#container").append(div);
				}
			}
					  
			
			for (var x = 1000 -(xLUTM % 1000); x < paperWidth*resolution+dxUTM; x+= 1000){
				var xUTMPos = x+xLUTM;
				var div = document.createElement("div");
				div.style.left=(0+x/resolution)*1000+"mm";
				if ((xUTMPos % 5000)>0){
					div.className="vline";
				} else {
					div.className="vlineThick";
				}
				$("#container").append(div);
				var div = document.createElement("div");
				div.innerText = xUTMPos/1000;
				div.style.left=(0+x/resolution)*1000+"mm";
				div.style.top=(-yOffsetMM+10)+"mm";
				div.className="xPosTop";
				$("#container").append(div);
				var div = document.createElement("div");
				div.innerText = xUTMPos/1000;
				div.style.left=(0+x/resolution)*1000+"mm";
				div.style.top=(-yOffsetMM+paperHeight*1000-15)+"mm";
				div.className="xPosBottom";
				$("#container").append(div);
			}
			
			for (var y = -((yHUTM) % 1000); -y < paperHeight*resolution+dyUTM; y-= 1000){
				var yUTMPos = yHUTM +y;
				var div = document.createElement("div");
				div.style.top=(0-y/resolution)*1000+"mm";
				div.className="hline";
				if ((yUTMPos % 5000)>0){
					div.className="hline";
				} else {
					div.className="hlineThick";
				}
				$("#container").append(div);
				
				var div = document.createElement("div");
				div.innerText = yUTMPos/1000;
				div.style.top=(0-y/resolution)*1000+"mm";
				div.style.left = (5-xOffsetMM)+"mm"
				div.className="yPosLeft";
				$("#container").append(div);
				var div = document.createElement("div");
				div.innerText = yUTMPos/1000;
				div.style.top=(0-y/resolution)*1000+"mm";
				div.style.left = (paperWidth*1000-10-xOffsetMM)+"mm"
				div.className="yPosRight";
				$("#container").append(div);
			}

		});              
		
	</script>
    </body>
</html>